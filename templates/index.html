{% extends "base.html" %}
{% block content %}

<div class="row mb-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="text-gradient mb-2">
                    <i class="fa-solid fa-gauge-high me-2"></i>
                    System Dashboard
                </h1>
                <p class="text-secondary mb-0">Real-time system monitoring and intelligent task scheduling</p>
            </div>
            <div>
                <span class="badge bg-success px-3 py-2">
                    <i class="fa-solid fa-circle-check me-2"></i>
                    All Systems Operational
                </span>
            </div>
        </div>
    </div>
</div>

<div class="row g-4 mb-4">
    <!-- Battery Card -->
    <div class="col-xl-4 col-md-6">
        <div class="card metric-card h-100 fade-in">
            <div class="card-header">
                <i class="fa-solid fa-battery-three-quarters"></i>
                Real-time Battery
            </div>
            <div class="card-body text-center">
                <div class="chart-container mb-3">
                    <canvas id="batteryChart" width="200" height="200"></canvas>
                </div>
                <div class="progress mb-3" style="height: 12px;">
                    <div id="batteryProgress" class="progress-bar" role="progressbar" 
                         style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                    </div>
                </div>
                <p id="batteryStatus" class="metric-label mb-0">Battery: --</p>
            </div>
        </div>
    </div>

    <!-- CPU Card -->
    <div class="col-xl-4 col-md-6">
        <div class="card metric-card h-100 fade-in" style="animation-delay: 0.1s;">
            <div class="card-header">
                <i class="fa-solid fa-microchip"></i>
                CPU Usage
            </div>
            <div class="card-body text-center">
                <div class="chart-container mb-3">
                    <canvas id="cpuChart" width="200" height="200"></canvas>
                </div>
                <div class="progress mb-3" style="height: 12px;">
                    <div id="cpuProgress" class="progress-bar bg-warning" role="progressbar" 
                         style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                    </div>
                </div>
                <p id="cpuStatus" class="metric-label mb-0">CPU: --</p>
            </div>
        </div>
    </div>

    <!-- Temperature Card -->
    <div class="col-xl-4 col-md-6">
        <div class="card metric-card h-100 fade-in" style="animation-delay: 0.2s;">
            <div class="card-header">
                <i class="fa-solid fa-temperature-half"></i>
                System Temperature
            </div>
            <div class="card-body text-center">
                <div class="chart-container mb-3">
                    <canvas id="tempChart" width="200" height="200"></canvas>
                </div>
                <div class="progress mb-3" style="height: 12px;">
                    <div id="tempProgress" class="progress-bar bg-danger" role="progressbar" 
                         style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                    </div>
                </div>
                <p id="tempStatus" class="metric-label mb-0">Temp: N/A</p>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-12">
        <div class="card fade-in" style="animation-delay: 0.3s;">
            <div class="card-header">
                <i class="fa-solid fa-sliders"></i>
                Task Scheduling Control
            </div>
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-lg-6 mb-3 mb-lg-0">
                        <div class="d-flex align-items-center">
                            <div class="me-3">
                                <i class="fa-solid fa-robot" style="font-size: 2.5rem; color: var(--accent-cyan);"></i>
                            </div>
                            <div>
                                <p class="mb-1 text-secondary" style="font-size: 0.875rem;">Current Scheduler Algorithm</p>
                                <h4 class="mb-0 text-gradient fw-bold">{{ scheduler_type }}</h4>
                                <small class="text-muted">
                                    <i class="fa-solid fa-microchip me-1"></i>
                                    AI-powered adaptive scheduling
                                </small>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="d-flex flex-wrap gap-2 justify-content-lg-end">
                            <a href="{{ url_for('set_scheduler', algo='fcfs') }}" 
                               class="btn btn-sm {% if scheduler_type == 'FCFS' %}btn-primary{% else %}btn-outline-primary{% endif %}">
                                <i class="fa-solid fa-arrow-right me-1"></i>FCFS
                            </a>
                            <a href="{{ url_for('set_scheduler', algo='sjf') }}" 
                               class="btn btn-sm {% if scheduler_type == 'SJF' %}btn-primary{% else %}btn-outline-primary{% endif %}">
                                <i class="fa-solid fa-bolt me-1"></i>SJF
                            </a>
                            <a href="{{ url_for('set_scheduler', algo='srtf') }}" 
                               class="btn btn-sm {% if scheduler_type == 'SRTF' %}btn-primary{% else %}btn-outline-primary{% endif %}">
                                <i class="fa-solid fa-clock me-1"></i>SRTF
                            </a>
                            <a href="{{ url_for('set_scheduler', algo='priority') }}" 
                               class="btn btn-sm {% if scheduler_type == 'Priority Scheduling' %}btn-primary{% else %}btn-outline-primary{% endif %}">
                                <i class="fa-solid fa-star me-1"></i>Priority
                            </a>
                            <a href="{{ url_for('set_scheduler', algo='rr') }}" 
                               class="btn btn-sm {% if scheduler_type == 'Round Robin' %}btn-primary{% else %}btn-outline-primary{% endif %}">
                                <i class="fa-solid fa-rotate me-1"></i>Round Robin
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-12">
        <div class="card fade-in" style="animation-delay: 0.4s;">
            <div class="card-header d-flex justify-content-between align-items-center">
                <div>
                    <i class="fa-solid fa-list-check"></i>
                    Active Tasks
                </div>
                <a href="{{ url_for('tasks_page') }}" class="btn btn-sm btn-outline-primary">
                    <i class="fa-solid fa-eye me-1"></i>View All
                </a>
            </div>
            <div class="card-body">
                <!-- Search and Filter -->
                <div class="row mb-3">
                    <div class="col-md-6 mb-2 mb-md-0">
                        <input id="taskSearch" class="form-control" placeholder="ðŸ” Search tasks..." 
                               style="background: rgba(255,255,255,0.05); border: 1px solid var(--card-border);">
                    </div>
                    <div class="col-md-6">
                        <select id="taskFilter" class="form-select" style="background: rgba(255,255,255,0.05); border: 1px solid var(--card-border);">
                            <option value="All">All Priorities</option>
                            <option value="High">High Priority</option>
                            <option value="Medium">Medium Priority</option>
                            <option value="Low">Low Priority</option>
                        </select>
                    </div>
                </div>

                <!-- Tasks Table -->
                <div class="table-responsive">
                    <table class="table table-hover" id="taskTable">
                        <thead>
                            <tr>
                                <th><i class="fa-solid fa-tag me-2"></i>Name</th>
                                <th><i class="fa-solid fa-flag me-2"></i>Priority</th>
                                <th><i class="fa-solid fa-circle-check me-2"></i>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Tasks will be populated by JS -->
                        </tbody>
                    </table>
                </div>

                <!-- Show More/Less Buttons -->
                <div class="mt-3 text-center">
                    <button id="showAllTasksBtn" class="btn btn-sm btn-primary">
                        <i class="fa-solid fa-chevron-down me-1"></i>Show All Tasks
                    </button>
                    <button id="showLessTasksBtn" class="btn btn-sm btn-secondary" style="display: none;">
                        <i class="fa-solid fa-chevron-up me-1"></i>Show Less
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-12">
        <div class="card fade-in" style="animation-delay: 0.5s;">
            <div class="card-header">
                <i class="fa-solid fa-sliders"></i>
                Threshold Configuration
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('update_thresholds') }}" id="thresholdForm">
                    <div class="row">
                        <!-- Battery Threshold -->
                        <div class="col-md-4 mb-4">
                            <label class="form-label d-flex justify-content-between">
                                <span>
                                    <i class="fa-solid fa-battery-quarter text-warning me-2"></i>
                                    Battery Low (%)
                                </span>
                                <span class="badge bg-warning text-dark" id="batterySliderValue">
                                    {{ thresholds.battery_low }}%
                                </span>
                            </label>
                            <input type="range" id="batterySlider" name="battery_low" 
                                   min="0" max="100" value="{{ thresholds.battery_low }}" 
                                   class="form-range">
                        </div>

                        <!-- CPU Threshold -->
                        <div class="col-md-4 mb-4">
                            <label class="form-label d-flex justify-content-between">
                                <span>
                                    <i class="fa-solid fa-microchip text-info me-2"></i>
                                    CPU High (%)
                                </span>
                                <span class="badge bg-info" id="cpuSliderValue">
                                    {{ thresholds.cpu_high }}%
                                </span>
                            </label>
                            <input type="range" id="cpuSlider" name="cpu_high" 
                                   min="0" max="100" value="{{ thresholds.cpu_high }}" 
                                   class="form-range">
                        </div>

                        <!-- Temperature Threshold -->
                        <div class="col-md-4 mb-4">
                            <label class="form-label d-flex justify-content-between">
                                <span>
                                    <i class="fa-solid fa-temperature-high text-danger me-2"></i>
                                    Temperature High (Â°C)
                                </span>
                                <span class="badge bg-danger" id="tempSliderValue">
                                    {{ thresholds.temp_high }}Â°C
                                </span>
                            </label>
                            <input type="range" id="tempSlider" name="temp_high" 
                                   min="0" max="100" value="{{ thresholds.temp_high }}" 
                                   class="form-range">
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="d-flex gap-2 justify-content-end">
                        <button type="button" id="resetBtn" class="btn btn-secondary">
                            <i class="fa-solid fa-rotate-left me-1"></i>Reset to Default
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fa-solid fa-save me-1"></i>Update Thresholds
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
// Pass initial tasks to JavaScript
window.initialTasks = {{ tasks|tojson }};

const batterySlider = document.getElementById("batterySlider");
const batteryValue = document.getElementById("batterySliderValue");
batterySlider.oninput = () => {
    batteryValue.textContent = batterySlider.value + "%";
};

const cpuSlider = document.getElementById("cpuSlider");
const cpuValue = document.getElementById("cpuSliderValue");
cpuSlider.oninput = () => {
    cpuValue.textContent = cpuSlider.value + "%";
};

const tempSlider = document.getElementById("tempSlider");
const tempValue = document.getElementById("tempSliderValue");
tempSlider.oninput = () => {
    tempValue.textContent = tempSlider.value + "Â°C";
};


const resetBtn = document.getElementById("resetBtn");
const form = document.getElementById("thresholdForm");

resetBtn.addEventListener("click", () => {
    // Default values
    const defaultBattery = 20;
    const defaultCpu = 80;
    const defaultTemp = 70;

    // Reset sliders visually
    batterySlider.value = defaultBattery;
    batteryValue.textContent = defaultBattery + "%";

    cpuSlider.value = defaultCpu;
    cpuValue.textContent = defaultCpu + "%";

    tempSlider.value = defaultTemp;
    tempValue.textContent = defaultTemp + "Â°C";

    // Submit with reset flag
    const hiddenReset = document.createElement("input");
    hiddenReset.type = "hidden";
    hiddenReset.name = "reset";
    hiddenReset.value = "true";
    form.appendChild(hiddenReset);
    form.submit();
});
</script>
{% endblock %}
